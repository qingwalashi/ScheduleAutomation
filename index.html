<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœåŠ¡è®¢é˜…ç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- æ·»åŠ  js-yaml åº“ç”¨äºè§£æ YAML -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
        /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
        .service-group {
            transition: all 0.3s ease-in-out;
        }
        
        .toggle-icon {
            transition: transform 0.3s ease;
            display: inline-block;
            width: 12px;
            text-align: center;
        }
        
        .toggle-icon.expanded {
            transform: rotate(90deg);
        }
        
        /* è‡ªå®šä¹‰è¡¨æ ¼æ ·å¼ */
        .sub-table {
            width: 100%;
            table-layout: fixed;
            background-color: #f9fafb;
            border-collapse: collapse;
        }
        
        .sub-table tr {
            border-bottom: 1px solid #f3f4f6;
        }
        
        .sub-table tr:last-child {
            border-bottom: none;
        }
        
        .sub-table tr:hover {
            background-color: #f3f4f6;
        }
        
        /* ä¸»è¡Œæ‚¬åœæ•ˆæœ */
        .main-row:hover {
            background-color: #f9fafb;
        }
        
        /* ç¡®ä¿å­è¡¨æ ¼ä¸ä¸»è¡¨æ ¼åˆ—å®½ä¸€è‡´ */
        .main-table {
            table-layout: fixed;
            width: 100%;
            border-collapse: collapse;
        }
        
        /* åˆ—å®½è®¾ç½® */
        .main-table th:nth-child(1),
        .main-table td:nth-child(1),
        .sub-table td:nth-child(1) {
            width: 25%;
        }
        
        .main-table th:nth-child(2),
        .main-table td:nth-child(2),
        .sub-table td:nth-child(2) {
            width: 15%;
        }
        
        .main-table th:nth-child(3),
        .main-table td:nth-child(3),
        .sub-table td:nth-child(3) {
            width: 10%;
        }
        
        .main-table th:nth-child(4),
        .main-table td:nth-child(4),
        .sub-table td:nth-child(4) {
            width: 15%;
        }
        
        .main-table th:nth-child(5),
        .main-table td:nth-child(5),
        .sub-table td:nth-child(5) {
            width: 15%;
        }
        
        .main-table th:nth-child(6),
        .main-table td:nth-child(6),
        .sub-table td:nth-child(6) {
            width: 20%;
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            
            .main-table th:nth-child(5),
            .main-table td:nth-child(5),
            .sub-table td:nth-child(5) {
                display: none;
            }
            
            .px-6 {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            
            .text-sm {
                font-size: 0.75rem;
            }
            
            .text-xs {
                font-size: 0.65rem;
            }
            
            .whitespace-nowrap {
                white-space: normal;
            }
            
            .costs-container {
                flex-direction: column;
                align-items: flex-end;
            }
            
            .costs-container .mx-2 {
                display: none;
            }
            
            /* ç§»åŠ¨ç«¯åˆ—å®½é‡æ–°åˆ†é… */
            .main-table th:nth-child(1),
            .main-table td:nth-child(1),
            .sub-table td:nth-child(1) {
                width: 30%;
            }
            
            .main-table th:nth-child(2),
            .main-table td:nth-child(2),
            .sub-table td:nth-child(2) {
                width: 20%;
            }
            
            .main-table th:nth-child(3),
            .main-table td:nth-child(3),
            .sub-table td:nth-child(3) {
                width: 15%;
            }
            
            .main-table th:nth-child(4),
            .main-table td:nth-child(4),
            .sub-table td:nth-child(4) {
                width: 15%;
            }
            
            .main-table th:nth-child(6),
            .main-table td:nth-child(6),
            .sub-table td:nth-child(6) {
                width: 20%;
            }
            
            /* ç¡®ä¿å­è¡¨æ ¼ä¸ä¸»è¡¨æ ¼å¯¹é½ */
            .sub-table {
                margin: 0;
                width: 100%;
            }
            
            .p-0 {
                padding: 0 !important;
            }
        }
        
        /* è¶…å°å±å¹•é€‚é… */
        @media (max-width: 480px) {
            .main-table th:nth-child(6),
            .main-table td:nth-child(6),
            .sub-table td:nth-child(6) {
                display: none;
            }
            
            .pl-12 {
                padding-left: 0.5rem;
            }
            
            /* è¶…å°å±å¹•åˆ—å®½é‡æ–°åˆ†é… */
            .main-table th:nth-child(1),
            .main-table td:nth-child(1),
            .sub-table td:nth-child(1) {
                width: 40%;
            }
            
            .main-table th:nth-child(2),
            .main-table td:nth-child(2),
            .sub-table td:nth-child(2) {
                width: 25%;
            }
            
            .main-table th:nth-child(3),
            .main-table td:nth-child(3),
            .sub-table td:nth-child(3) {
                width: 15%;
            }
            
            .main-table th:nth-child(4),
            .main-table td:nth-child(4),
            .sub-table td:nth-child(4) {
                width: 20%;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">æœåŠ¡è®¢é˜…ç®¡ç†</h1>
        
        <!-- åŸŸååˆ°æœŸä¿¡æ¯ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">åŸŸååˆ°æœŸä¿¡æ¯</h2>
            <div class="space-y-4">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åŸŸå</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åˆ°æœŸæ—¥æœŸ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SSLåˆ°æœŸæ—¥æœŸ</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="domainTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- è®¢é˜…æœåŠ¡ä¿¡æ¯ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">è®¢é˜…æœåŠ¡ä¿¡æ¯</h2>
            <div class="space-y-4">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200 main-table">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æœåŠ¡åç§°</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åˆ°æœŸæ—¥æœŸ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è´¹ç”¨</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å‰©ä½™|è¶…æœŸå¤©æ•°</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åˆ†ç±»</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="subscriptionTableBody">
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 text-right">
                    <p class="text-lg font-semibold text-gray-700 flex justify-end costs-container">
                        <span>æ€»è´¹ç”¨ï¼š<span id="totalCost" class="text-blue-600">Â¥0.00</span></span>
                        <span class="mx-2 text-gray-400">|</span>
                        <span>è®¢é˜…ä¸­ï¼š<span id="activeCost" class="text-green-600">Â¥0.00</span></span>
                    </p>
                </div>
            </div>
        </div>

        <!-- ICS è®¢é˜…åœ°å€ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">ICS è®¢é˜…åœ°å€</h2>
            <div class="space-y-4">
                <div class="flex flex-col space-y-4">
                    <div class="flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-4">
                        <span class="text-gray-700 whitespace-nowrap">åŸŸååˆ°æœŸæé†’ï¼š</span>
                        <div class="flex flex-1 items-center space-x-2">
                            <input type="text" id="domainIcsUrl" readonly 
                                   class="flex-1 px-4 py-2 border rounded-lg bg-gray-50 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                            <button onclick="copyIcsUrl('domainIcsUrl')" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors whitespace-nowrap">
                                å¤åˆ¶
                            </button>
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-4">
                        <span class="text-gray-700 whitespace-nowrap">è®¢é˜…æœåŠ¡æé†’ï¼š</span>
                        <div class="flex flex-1 items-center space-x-2">
                            <input type="text" id="subscriptionIcsUrl" readonly 
                                   class="flex-1 px-4 py-2 border rounded-lg bg-gray-50 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                            <button onclick="copyIcsUrl('subscriptionIcsUrl')" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors whitespace-nowrap">
                                å¤åˆ¶
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è®¡ç®—å‰©ä½™æˆ–è¶…æœŸå¤©æ•°
        function calculateDaysRemaining(expiryDate) {
            if (!expiryDate || expiryDate === 'permanent') {
                return null;
            }
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const expiry = new Date(expiryDate);
            expiry.setHours(0, 0, 0, 0);
            
            const diffTime = expiry - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // è·å–å¤©æ•°æ˜¾ç¤ºæ ·å¼
        function getDaysDisplayStyle(days) {
            if (days === null) return 'bg-gray-100 text-gray-800';
            if (days < 0) return 'bg-red-100 text-red-800'; // å·²è¿‡æœŸ
            if (days <= 30) return 'bg-orange-100 text-orange-800'; // 30å¤©å†…
            return 'bg-green-100 text-green-800'; // 30å¤©ä»¥ä¸Š
        }

        // è·å–å¤©æ•°æ˜¾ç¤ºæ–‡æœ¬
        function getDaysDisplayText(days) {
            if (days === null) return '-';
            return `${Math.abs(days)}å¤©`;
        }

        // åˆ†ç±» emoji æ˜ å°„
        const categoryEmojis = {
            'è´­ç‰©': 'ğŸ›ï¸',
            'æ•ˆç‡å·¥å…·': 'âš¡',
            'AIæœåŠ¡': 'ğŸ¤–',
            'ç½‘ç»œæœåŠ¡': 'ğŸŒ'
        };

        // åŠ è½½ YAML æ–‡ä»¶
        async function loadYamlFile(path) {
            try {
                const response = await fetch(path);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const yamlText = await response.text();
                return jsyaml.load(yamlText);
            } catch (error) {
                console.error('Error loading YAML file:', error);
                return null;
            }
        }

        // æ¸²æŸ“åŸŸåè¡¨æ ¼
        function renderDomainTable(domainConfig) {
            const tbody = document.getElementById('domainTableBody');
            tbody.innerHTML = '';

            if (!domainConfig || !domainConfig.domains_expiry) {
                tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-4 text-center text-gray-500">åŠ è½½å¤±è´¥</td></tr>';
                return;
            }

            for (const domain in domainConfig.domains_expiry) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <a href="https://${domain}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline">${domain}</a>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${domainConfig.domains_expiry[domain]}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${domainConfig.domains_ssl_expiry[domain] || '-'}</td>
                `;
                tbody.appendChild(row);
            }
        }

        // æ¸²æŸ“è®¢é˜…æœåŠ¡è¡¨æ ¼
        function renderSubscriptionTable(subscriptionConfig) {
            const tbody = document.getElementById('subscriptionTableBody');
            tbody.innerHTML = '';

            if (!subscriptionConfig || !subscriptionConfig.subscription_services) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">åŠ è½½å¤±è´¥</td></tr>';
                return;
            }

            // æŒ‰åç§°åˆ†ç»„æœåŠ¡
            const groupedServices = {};
            for (const [id, service] of Object.entries(subscriptionConfig.subscription_services)) {
                if (!groupedServices[service.name]) {
                    groupedServices[service.name] = [];
                }
                groupedServices[service.name].push({ id, ...service });
            }

            // æŒ‰åˆ†ç±»æ’åºæœåŠ¡ç»„
            const serviceGroups = Object.entries(groupedServices)
                .sort((a, b) => {
                    // é¦–å…ˆæŒ‰åˆ†ç±»æ’åº
                    const categoryCompare = a[1][0].category.localeCompare(b[1][0].category);
                    if (categoryCompare !== 0) return categoryCompare;
                    // ç„¶åæŒ‰åç§°æ’åº
                    return a[0].localeCompare(b[0]);
                });

            let totalActiveCost = 0; // è®¢é˜…ä¸­çš„è´¹ç”¨
            let totalAllCost = 0;    // æ‰€æœ‰è´¹ç”¨ï¼ˆåŒ…æ‹¬å·²åˆ°æœŸï¼‰
            let currentCategory = '';
            let groupIndex = 0;

            for (const [serviceName, services] of serviceGroups) {
                // å¦‚æœæ˜¯æ–°çš„åˆ†ç±»ï¼Œæ·»åŠ åˆ†ç±»æ ‡é¢˜è¡Œ
                if (services[0].category !== currentCategory) {
                    currentCategory = services[0].category;
                    const categoryRow = document.createElement('tr');
                    categoryRow.innerHTML = `
                        <td colspan="6" class="px-6 py-3 bg-gray-100 text-sm font-medium text-gray-700">${services[0].category}</td>
                    `;
                    tbody.appendChild(categoryRow);
                }

                // æŒ‰åˆ°æœŸæ—¥æœŸé™åºæ’åºæœåŠ¡
                services.sort((a, b) => {
                    if (a.expiry_date === 'permanent') return 1;
                    if (b.expiry_date === 'permanent') return -1;
                    return new Date(b.expiry_date) - new Date(a.expiry_date);
                });

                // å¦‚æœåªæœ‰ä¸€ä¸ªæœåŠ¡ï¼Œç›´æ¥æ˜¾ç¤º
                if (services.length === 1) {
                    const service = services[0];
                    const daysRemaining = calculateDaysRemaining(service.expiry_date);
                    const daysStyle = getDaysDisplayStyle(daysRemaining);
                    const daysText = getDaysDisplayText(daysRemaining);

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${service.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${service.expiry_date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Â¥${service.cost.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${service.status === 'è®¢é˜…ä¸­' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${service.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${daysStyle}">
                                ${daysText}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${service.category}</td>
                    `;
                    tbody.appendChild(row);

                    // ç´¯åŠ æ€»è´¹ç”¨
                    totalAllCost += service.cost;
                    if (service.status === 'è®¢é˜…ä¸­') {
                        totalActiveCost += service.cost;
                    }
                } else {
                    // å¤šä¸ªç›¸åŒåç§°çš„æœåŠ¡ï¼Œåˆ›å»ºå¯æŠ˜å ç»„
                    const mainService = services[0]; // æœ€æ–°çš„æœåŠ¡
                    const daysRemaining = calculateDaysRemaining(mainService.expiry_date);
                    const daysStyle = getDaysDisplayStyle(daysRemaining);
                    const daysText = getDaysDisplayText(daysRemaining);

                    // è®¡ç®—æ‰€æœ‰å­é¡¹çš„æ€»ä»·æ ¼
                    let totalServiceCost = 0;
                    let activeServiceCount = 0;
                    for (const service of services) {
                        // ç´¯åŠ æ‰€æœ‰æœåŠ¡çš„è´¹ç”¨ï¼Œæ— è®ºçŠ¶æ€å¦‚ä½•
                        totalServiceCost += service.cost;
                        
                        if (service.status === 'è®¢é˜…ä¸­') {
                            activeServiceCount++;
                        }
                    }

                    // ä¸»è¡Œï¼ˆå¯ç‚¹å‡»å±•å¼€ï¼‰
                    const mainRow = document.createElement('tr');
                    mainRow.className = 'cursor-pointer hover:bg-gray-50 main-row';
                    const currentGroupIndex = groupIndex;
                    mainRow.addEventListener('click', function() {
                        toggleServiceGroup(currentGroupIndex);
                    });
                    mainRow.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <div class="flex items-center">
                                <span class="mr-2 text-gray-500 toggle-icon group-toggle-${groupIndex}">â–º</span>
                                ${serviceName} <span class="ml-2 text-xs text-gray-500">(${services.length}ä¸ª)</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mainService.expiry_date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Â¥${totalServiceCost.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${activeServiceCount > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${activeServiceCount > 0 ? 'è®¢é˜…ä¸­' : 'å·²åˆ°æœŸ'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${daysStyle}">
                                ${daysText}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mainService.category}</td>
                    `;
                    tbody.appendChild(mainRow);

                    // å­è¡Œï¼ˆé»˜è®¤éšè—ï¼‰
                    const subRowsContainer = document.createElement('tr');
                    subRowsContainer.className = `service-group service-group-${groupIndex} hidden`;
                    subRowsContainer.innerHTML = '<td colspan="6" class="p-0"></td>';
                    const subRowsCell = subRowsContainer.querySelector('td');
                    
                    // åˆ›å»ºå­è¡¨æ ¼
                    const subTable = document.createElement('table');
                    subTable.className = 'sub-table';
                    
                    // åˆ›å»ºè¡¨ä½“
                    const subTbody = document.createElement('tbody');
                    subTbody.className = 'bg-gray-50';
                    subTable.appendChild(subTbody);
                    
                    // æ·»åŠ å­æœåŠ¡è¡Œ
                    for (const service of services) {
                        const subDaysRemaining = calculateDaysRemaining(service.expiry_date);
                        const subDaysStyle = getDaysDisplayStyle(subDaysRemaining);
                        const subDaysText = getDaysDisplayText(subDaysRemaining);
                        
                        const subRow = document.createElement('tr');
                        subRow.className = 'transition-colors hover:bg-gray-100';
                        subRow.innerHTML = `
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-600 pl-12">${service.name}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-600">${service.expiry_date}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-600">Â¥${service.cost.toFixed(2)}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${service.status === 'è®¢é˜…ä¸­' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${service.status}
                                </span>
                            </td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${subDaysStyle}">
                                    ${subDaysText}
                                </span>
                            </td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-600">${service.category}</td>
                        `;
                        subTbody.appendChild(subRow);
                    }
                    
                    subRowsCell.appendChild(subTable);
                    tbody.appendChild(subRowsContainer);
                    groupIndex++;
                    
                    // ç´¯åŠ æ€»è´¹ç”¨
                    totalAllCost += totalServiceCost;
                    
                    // ç´¯åŠ æ´»è·ƒæœåŠ¡çš„è´¹ç”¨
                    for (const service of services) {
                        if (service.status === 'è®¢é˜…ä¸­') {
                            totalActiveCost += service.cost;
                        }
                    }
                }
            }

            // æ›´æ–°æ€»è´¹ç”¨æ˜¾ç¤º
            document.getElementById('totalCost').textContent = `Â¥${totalAllCost.toFixed(2)}`;
            document.getElementById('activeCost').textContent = `Â¥${totalActiveCost.toFixed(2)}`;
        }

        // åˆ‡æ¢æœåŠ¡ç»„æ˜¾ç¤º/éšè—
        function toggleServiceGroup(groupIndex) {
            const groupRows = document.querySelectorAll(`.service-group-${groupIndex}`);
            const toggleIcon = document.querySelector(`.group-toggle-${groupIndex}`);
            
            if (groupRows.length > 0) {
                groupRows.forEach(row => {
                    row.classList.toggle('hidden');
                });
                
                if (toggleIcon) {
                    toggleIcon.classList.toggle('expanded');
                }
            }
        }

        // å¤åˆ¶ ICS URL
        function copyIcsUrl(inputId) {
            const input = document.getElementById(inputId);
            input.select();
            document.execCommand('copy');
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'å·²å¤åˆ¶';
            btn.classList.add('bg-green-500');
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('bg-green-500');
            }, 2000);
        }

        // è·å–å½“å‰åŸŸå
        function getCurrentDomain() {
            return window.location.hostname || 'localhost';
        }

        // è·å– ICS URL
        function getIcsUrl(filename) {
            const domain = getCurrentDomain();
            const protocol = window.location.protocol;
            const port = window.location.port ? `:${window.location.port}` : '';
            // æ ¹æ®æ–‡ä»¶åç¡®å®šæ­£ç¡®çš„æ–‡ä»¶å¤¹è·¯å¾„
            const folder = filename.includes('domain') ? 'domain_expiry' : 'subscription_services';
            return `${protocol}//${domain}${port}/${folder}/${filename}`;
        }

        // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½æ•°æ®å¹¶æ¸²æŸ“
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // åŠ è½½åŸŸåé…ç½®
                const domainConfig = await loadYamlFile('domain_expiry/domain_expiry.yaml');
                renderDomainTable(domainConfig);

                // åŠ è½½è®¢é˜…æœåŠ¡é…ç½®
                const subscriptionConfig = await loadYamlFile('subscription_services/subscription_services.yaml');
                renderSubscriptionTable(subscriptionConfig);

                // è®¾ç½® ICS URL
                document.getElementById('domainIcsUrl').value = getIcsUrl('domain_expiry_calendar.ics');
                document.getElementById('subscriptionIcsUrl').value = getIcsUrl('subscription_services_calendar.ics');
            } catch (error) {
                console.error('Error loading data:', error);
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                document.getElementById('domainTableBody').innerHTML = 
                    '<tr><td colspan="3" class="px-6 py-4 text-center text-red-500">åŠ è½½æ•°æ®å¤±è´¥</td></tr>';
                document.getElementById('subscriptionTableBody').innerHTML = 
                    '<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">åŠ è½½æ•°æ®å¤±è´¥</td></tr>';
            }
        });
    </script>
</body>
</html> 